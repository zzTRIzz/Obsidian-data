D∆∞·ªõi ƒë√¢y l√† h∆∞·ªõng d·∫´n chi ti·∫øt v·ªÅ **Tool Calling** trong Spring AI:

```cardlink
url: https://www.youtube.com/watch?v=e-xNf3PdYTg
title: "Spring AI (Part 3): Tool Calling and Model Context Protocol"
description: "Hello everyone,In this video, we will work with tool calling feature and see how we can setup MCP (Model Context Protocol) server and client interaction usin..."
host: www.youtube.com
favicon: https://www.youtube.com/s/desktop/c722ba88/img/logos/favicon_32x32.png
image: https://i.ytimg.com/vi/e-xNf3PdYTg/maxresdefault.jpg
```

S·ª≠ d·ª•ng chung c√πng th∆∞ vi·ªán OpenAi d√πng v·ªõi Gemini: 
```cardlink
url: https://www.youtube.com/watch?v=5zhNfPH-jps&t=11s
title: "How to Use Google Gemini Flash 2.0 with Just an API Key in Spring AI"
description: "üî• This video shows how to use Google Gemini Flash 2.0 with just a simple API key in your Spring AI applications!In this tutorial, I show you how to integrat..."
host: www.youtube.com
favicon: https://www.youtube.com/s/desktop/c722ba88/img/logos/favicon_32x32.png
image: https://i.ytimg.com/vi/5zhNfPH-jps/maxresdefault.jpg
```

Danh s√°ch c√°c Model Ai Free c·ªßa OpenRouter h·ªó tr·ª£ @ToolCalling:

```
spring:  
  application:  
    name : ai  
  
  ai:  
    openai:  
      base-url: https://openrouter.ai/api   
      api-key: <YOU_API_KEY> 
      chat:  
        options:  
          #support @Tool  
          #model: mistralai/mistral-7b-instruct:free          
          model: google/gemini-2.0-flash-exp:free  
          #model: mistralai/mistral-small-3.1-24b-instruct:free  
  
          #Not supported @Tool          
          #model: deepseek/deepseek-chat-v3-0324:free          
          #model: google/gemini-2.5-pro-exp-03-25:free          
          #model: deepseek/deepseek-r1:free          
          #model: deepseek/deepseek-r1-distill-llama-70b:free           
          #model: mistralai/mistral-small-3.1-24b-instruct:free      
```


```cardlink
url: https://openrouter.ai/models?fmt=table&order=top-weekly&q=free&supported_parameters=tools
title: "Models support @Tool: 'free' | OpenRouter"
description: "Browse models on OpenRouter"
host: openrouter.ai
favicon: https://openrouter.ai/favicon.ico
image: https://openrouter.ai/dynamic-og?pathname=models&title=Models%3A+%27free%27&description=Browse+models+on+OpenRouter
```

---

### **1. Gi·ªõi Thi·ªáu Tool Calling**
Tool Calling cho ph√©p AI Model g·ªçi c√°c h√†m/c√¥ng c·ª• b√™n ngo√†i ƒë·ªÉ:
- **L·∫•y th√¥ng tin** (VD: th·ªùi ti·∫øt, th·ªùi gian hi·ªán t·∫°i)
- **Th·ª±c hi·ªán h√†nh ƒë·ªông** (VD: ƒë·∫∑t b√°o th·ª©c, g·ª≠i email)

**L∆∞u √Ω quan tr·ªçng**:
- Model ch·ªâ **y√™u c·∫ßu** g·ªçi tool, ·ª©ng d·ª•ng **x·ª≠ l√Ω th·ª±c t·∫ø**
- Tool ƒë∆∞·ª£c ƒë·ªãnh nghƒ©a b·∫±ng Java methods

---

### **2. Tri·ªÉn Khai Tool v·ªõi @Tool Annotation**
#### **B∆∞·ªõc 1: ƒê·ªãnh nghƒ©a Tool Class**
```java
import org.springframework.ai.tool.annotation.Tool;
import java.time.LocalDateTime;

public class DateTimeTools {
    
    @Tool(description = "L·∫•y th·ªùi gian hi·ªán t·∫°i theo m√∫i gi·ªù ng∆∞·ªùi d√πng")
    public String getCurrentTime() {
        return LocalDateTime.now().toString();
    }

    @Tool(description = "ƒê·∫∑t b√°o th·ª©c theo th·ªùi gian ISO-8601")
    public void setAlarm(String isoTime) {
        System.out.println("B√°o th·ª©c ƒë·∫∑t l√∫c: " + isoTime);
    }
}
```

#### **B∆∞·ªõc 2: S·ª≠ d·ª•ng Tool trong ChatClient**
```java
ChatModel chatModel = ... // Kh·ªüi t·∫°o ChatModel (OpenAI, Azure, etc.)

String response = ChatClient.create(chatModel)
    .prompt("B√¢y gi·ªù l√† m·∫•y gi·ªù?")
    .tools(new DateTimeTools()) // Th√™m tools
    .call()
    .content();

System.out.println(response); // "Hi·ªán t·∫°i l√† 2024-05-20T15:30:00"
```

---

### **3. X·ª≠ L√Ω Tham S·ªë Ph·ª©c T·∫°p**
S·ª≠ d·ª•ng `@ToolParam` ƒë·ªÉ m√¥ t·∫£ tham s·ªë:
```java
public class WeatherTools {
    
    @Tool(description = "L·∫•y nhi·ªát ƒë·ªô theo th√†nh ph·ªë")
    public int getTemperature(
        @ToolParam(description = "T√™n th√†nh ph·ªë (VD: H√† N·ªôi, TP.HCM)") String city
    ) {
        return 30; // Gi·∫£ l·∫≠p
    }
}
```

---

### **4. Tool Th·ª±c Hi·ªán H√†nh ƒê·ªông**
V√≠ d·ª• ƒë·∫∑t b√°o th·ª©c k·∫øt h·ª£p nhi·ªÅu tools:
```java
DateTimeTools tools = new DateTimeTools();
String response = ChatClient.create(chatModel)
    .prompt("ƒê·∫∑t b√°o th·ª©c sau 10 ph√∫t n·ªØa")
    .tools(tools)
    .call()
    .content();

// Logs: "B√°o th·ª©c ƒë·∫∑t l√∫c: 2024-05-20T15:40:00"
```

---

### **5. C·∫•u H√¨nh N√¢ng Cao**
#### **Th√™m Tool M·∫∑c ƒê·ªãnh**
```java
// Th√™m v√†o ChatClient
ChatClient client = ChatClient.builder(chatModel)
    .defaultTools(new DateTimeTools())
    .build();

// Th√™m v√†o ChatModel
ChatModel model = OpenAiChatModel.builder()
    .defaultOptions(ToolCallingChatOptions.builder()
        .toolCallbacks(ToolCallbacks.from(new WeatherTools()))
        .build())
    .build();
```

#### **X·ª≠ L√Ω K·∫øt Qu·∫£ Tr·ª±c Ti·∫øp**
```java
@Tool(description = "Tr·∫£ k·∫øt qu·∫£ th·∫≥ng cho client", returnDirect = true)
public String directResponse() {
    return "K·∫øt qu·∫£ tr·ª±c ti·∫øp";
}
```

---

### **6. Gi·ªõi H·∫°n v√† L∆∞u √ù**
- **Ki·ªÉu d·ªØ li·ªáu kh√¥ng h·ªó tr·ª£**: `Optional`, `CompletableFuture`, reactive types
- **B·∫£o m·∫≠t**: Lu√¥n validate input t·ª´ model
- **Hi·ªáu su·∫•t**: H·∫°n ch·∫ø tools c√≥ x·ª≠ l√Ω t·ªën th·ªùi gian

---

### **7. X·ª≠ L√Ω L·ªói**
```java
try {
    String response = ChatClient.create(chatModel)
        .prompt("ƒê·∫∑t b√°o th·ª©c sai ƒë·ªãnh d·∫°ng th·ªùi gian")
        .tools(new DateTimeTools())
        .call()
        .content();
} catch (ToolExecutionException e) {
    System.err.println("L·ªói th·ª±c thi tool: " + e.getMessage());
}
```

---

### **8. Best Practices**
- **M√¥ t·∫£ r√µ r√†ng**: Gi√∫p model hi·ªÉu khi n√†o c·∫ßn g·ªçi tool
- **T√°ch bi·ªát logic**: M·ªói tool ch·ªâ l√†m m·ªôt nhi·ªám v·ª•
- **Logging**: Ghi l·∫°i c√°c l·∫ßn g·ªçi tool ƒë·ªÉ debug
- **Phi√™n b·∫£n h√≥a**: Qu·∫£n l√Ω thay ƒë·ªïi tool theo version

---

### **K·∫øt Lu·∫≠n**
V·ªõi Spring AI Tool Calling, b·∫°n c√≥ th·ªÉ:
- **M·ªü r·ªông kh·∫£ nƒÉng** c·ªßa AI Model
- **T√≠ch h·ª£p h·ªá th·ªëng** hi·ªán c√≥
- **T·ª± ƒë·ªông h√≥a** quy tr√¨nh ph·ª©c t·∫°p

B·∫Øt ƒë·∫ßu v·ªõi c√°c v√≠ d·ª• ƒë∆°n gi·∫£n v√† d·∫ßn ph·ª©c t·∫°p h√≥a ƒë·ªÉ t·∫≠n d·ª•ng t·ªëi ƒëa t√≠nh nƒÉng n√†y! üöÄ

---

ƒê·ªÉ ti·∫øp t·ª•c hi·ªÉu s√¢u h∆°n v·ªÅ Tool Calling trong Spring AI, h√£y c√πng xem m·ªôt v√≠ d·ª• m·ªü r·ªông v√† gi·∫£i th√≠ch chi ti·∫øt:

### V√≠ d·ª• M·ªü R·ªông: H·ªá Th·ªëng ƒê·∫∑t L·ªãch H·ªçp
```java
// B∆∞·ªõc 1: ƒê·ªãnh nghƒ©a c√°c Tool
import org.springframework.ai.tool.annotation.*;
import java.time.*;
import java.util.*;

public class MeetingTools {
    
    @Tool(description = "Ki·ªÉm tra l·ªãch tr√¨nh trong kho·∫£ng th·ªùi gian")
    public boolean checkAvailability(
        @ToolParam(description = "Th·ªùi gian b·∫Øt ƒë·∫ßu (ISO-8601)") String start,
        @ToolParam(description = "Th·ªùi gian k·∫øt th√∫c (ISO-8601)") String end
    ) {
        // Gi·∫£ l·∫≠p logic ki·ªÉm tra l·ªãch
        return Math.random() > 0.5; // 50% c∆° h·ªôi available
    }

    @Tool(description = "T·∫°o cu·ªôc h·ªçp m·ªõi", returnDirect = true)
    public String createMeeting(
        @ToolParam(description = "Ti√™u ƒë·ªÅ cu·ªôc h·ªçp") String title,
        @ToolParam(description = "Danh s√°ch ng∆∞·ªùi tham d·ª± (email)") List<String> attendees,
        @ToolParam(description = "Th·ªùi gian b·∫Øt ƒë·∫ßu (ISO-8601)") String startTime
    ) {
        // Logic l∆∞u cu·ªôc h·ªçp v√†o database
        return String.format("Cu·ªôc h·ªçp '%s' ƒë√£ ƒë∆∞·ª£c l√™n l·ªãch v√†o %s v·ªõi %d ng∆∞·ªùi tham d·ª±",
                           title, startTime, attendees.size());
    }
}

// B∆∞·ªõc 2: Tri·ªÉn khai Chat Client
public class MeetingScheduler {

    public static void main(String[] args) {
        ChatModel chatModel = new OpenAiChatModel(/* config */);
        MeetingTools meetingTools = new MeetingTools();
        
        String userRequest = "L·∫≠p cu·ªôc h·ªçp ki·ªÉm tra d·ª± √°n v√†o 3PM ng√†y mai v·ªõi an@example.com v√† minh@example.com";
        
        try {
            String response = ChatClient.create(chatModel)
                .prompt(userRequest)
                .tools(meetingTools)
                .call()
                .content();
            
            System.out.println("Ph·∫£n h·ªìi: " + response);
        } catch (ToolExecutionException e) {
            System.err.println("L·ªói khi x·ª≠ l√Ω y√™u c·∫ßu: " + e.getCause().getMessage());
        }
    }
}
```

### Gi·∫£i Th√≠ch Chi Ti·∫øt:
1. **Lu·ªìng X·ª≠ L√Ω:**
   - Model ph√¢n t√≠ch c√¢u h·ªèi v√† x√°c ƒë·ªãnh c·∫ßn g·ªçi `checkAvailability` tr∆∞·ªõc
   - N·∫øu available, g·ªçi ti·∫øp `createMeeting` v·ªõi c√°c tham s·ªë ƒë√£ ƒë∆∞·ª£c chu·∫©n h√≥a
   - K·∫øt qu·∫£ t·ª´ `createMeeting` ƒë∆∞·ª£c tr·∫£ th·∫≥ng do `returnDirect = true`

2. **X·ª≠ L√Ω Tham S·ªë Ph·ª©c T·∫°p:**
   ```java
   @Tool(description = "G·ª≠i th√¥ng b√°o qua c√°c k√™nh")
   public void sendNotification(
       @ToolParam(description = "Lo·∫°i th√¥ng b√°o (email/sms/push)") NotificationType type,
       @ToolParam(description = "N·ªôi dung template v·ªõi {placeholder}") String template,
       @ToolParam(description = "D·ªØ li·ªáu thay th·∫ø") Map<String, Object> data
   ) {
       // Render template v·ªõi data
   }
   ```
   - Spring AI t·ª± ƒë·ªông convert JSON t·ª´ model sang Java types

3. **K·∫øt H·ª£p Nhi·ªÅu Tools:**
   ```java
   ChatClient.create(chatModel)
       .prompt("L√™n l·ªãch h·ªçp v√† th√¥ng b√°o cho team")
       .tools(new MeetingTools(), new NotificationTools())
       .call()
   ```

4. **X·ª≠ L√Ω Temporal Logic:**
   - Model t·ª± ƒë·ªông x·ª≠ l√Ω c√°c bi·ªÉu th·ª©c th·ªùi gian ("3PM ng√†y mai")
   - Convert th√†nh ISO-8601 ch√≠nh x√°c tr∆∞·ªõc khi g·ªçi tool

### Pattern X·ª≠ L√Ω N√¢ng Cao:
```java
// S·ª≠ d·ª•ng AOP cho logging
@Aspect
@Component
public class ToolLoggingAspect {
    
    @Before("@annotation(org.springframework.ai.tool.annotation.Tool)")
    public void logToolCall(JoinPoint joinPoint) {
        String toolName = joinPoint.getSignature().toShortString();
        Object[] args = joinPoint.getArgs();
        System.out.printf("[TOOL CALL] %s with args: %s%n", toolName, Arrays.toString(args));
    }
}

// S·ª≠ d·ª•ng Custom Converters
@Configuration
public class ToolConfig {
    
    @Bean
    public CustomConversionService conversionService() {
        CustomConversionService conversionService = new CustomConversionService();
        conversionService.addConverter(String.class, NotificationType.class, 
            source -> NotificationType.valueOf(source.toUpperCase()));
        return conversionService;
    }
}
```

### K·ªãch B·∫£n X·ª≠ L√Ω L·ªói Chi Ti·∫øt:
1. **Invalid Parameters:**
   - Model truy·ªÅn tham s·ªë kh√¥ng ƒë√∫ng ƒë·ªãnh d·∫°ng
   - Spring AI throw `IllegalArgumentException` wrapped trong `ToolExecutionException`

2. **Tool Dependency Failure:**
   ```java
   @Tool(description = "ƒê·ªìng b·ªô v·ªõi Google Calendar")
   public void syncWithGoogleCalendar(MeetingDetails details) {
       try {
           googleCalendarClient.sync(details);
       } catch (GoogleApiException e) {
           throw new ToolExecutionException("L·ªói ƒë·ªìng b·ªô calendar", e);
       }
   }
   ```

3. **Retry Mechanism:**
   ```java
   @Retryable(retryFor = ToolExecutionException.class, maxAttempts = 3)
   @Tool(description = "G·ªçi API b√™n ngo√†i")
   public String callExternalService() {
       // Code c√≥ th·ªÉ fail t·∫°m th·ªùi
   }
   ```

### Best Practices M·ªü R·ªông:
1. **Version Control cho Tools:**
   ```java
   @Tool(description = "API v1 - ƒê·∫∑t l·ªãch h·ªçp")
   public void createMeetingV1(...) {}
   
   @Tool(description = "API v2 - ƒê·∫∑t l·ªãch h·ªçp n√¢ng cao")
   public void createMeetingV2(...) {}
   ```

2. **Security Validation:**
   ```java
   @Tool(description = "Truy v·∫•n d·ªØ li·ªáu ng∆∞·ªùi d√πng")
   public UserData getUserData(
       @ToolParam(description = "User ID") String userId,
       @CurrentSecurityContext SecurityContext context
   ) {
       if (!context.getUser().hasPermission("VIEW_USER_DATA")) {
           throw new AccessDeniedException("Kh√¥ng c√≥ quy·ªÅn truy c·∫≠p");
       }
       return userService.getData(userId);
   }
   ```

3. **Performance Monitoring:**
   ```java
   @Tool(description = "Truy v·∫•n database")
   @Timed(value = "tool.db_query", description = "Th·ªùi gian th·ª±c thi DB query")
   public QueryResult executeQuery(String sql) {
       // ...
   }
   ```

### K·∫øt Lu·∫≠n:
Tool Calling trong Spring AI m·ªü ra kh·∫£ nƒÉng:
- T√≠ch h·ª£p li·ªÅn m·∫°ch gi·ªØa AI v√† h·ªá th·ªëng nghi·ªáp v·ª•
- X·ª≠ l√Ω c√°c t√°c v·ª• ph·ª©c t·∫°p v·ªõi logic ph√¢n t·∫ßng
- D·ªÖ d√†ng m·ªü r·ªông v√† b·∫£o tr√¨ v·ªõi c√°c pattern enterprise

H√£y b·∫Øt ƒë·∫ßu v·ªõi c√°c use case ƒë∆°n gi·∫£n v√† d·∫ßn √°p d·ª•ng c√°c k·ªπ thu·∫≠t n√¢ng cao khi ƒë√£ hi·ªÉu r√µ c∆° ch·∫ø ho·∫°t ƒë·ªông!