D∆∞·ªõi ƒë√¢y l√† h∆∞·ªõng d·∫´n chi ti·∫øt v·ªÅ **MCP Server Boot Starter** trong Spring AI, ƒë∆∞·ª£c tr√¨nh b√†y qua c√°c ph·∫ßn ch√≠nh v·ªõi v√≠ d·ª• minh h·ªça:

---

### **1. T·ªïng Quan v·ªÅ MCP Server Boot Starter**
**MCP Server Boot Starter** gi√∫p tri·ªÉn khai server MCP trong ·ª©ng d·ª•ng Spring Boot, h·ªó tr·ª£:
- T√≠ch h·ª£p v·ªõi Spring AI Tool Framework
- H·ªó tr·ª£ c·∫£ SYNC v√† ASYNC mode
- 3 lo·∫°i transport: STDIO, WebMVC SSE, WebFlux SSE
- Qu·∫£n l√Ω tools, resources, prompts

---

### **2. C√†i ƒê·∫∑t C∆° B·∫£n**
#### **2.1. Th√™m Dependency**
```xml
<!-- WebFlux -->
<dependency>
    <groupId>org.springframework.ai</groupId>
    <artifactId>spring-ai-starter-mcp-server-webflux</artifactId>
</dependency>

<!-- Ho·∫∑c WebMVC -->
<dependency>
    <groupId>org.springframework.ai</groupId>
    <artifactId>spring-ai-starter-mcp-server-webmvc</artifactId>
</dependency>
```

#### **2.2. C·∫•u H√¨nh Server**
```yaml
# application.yml
spring:
  ai:
    mcp:
      server:
        name: weather-server
        version: 1.0.0
        type: ASYNC
        sse-endpoint: /api/sse
        sse-message-endpoint: /api/messages
        tool-response-mime-type:
          generateReport: application/pdf
```

---

### **3. ƒê·ªãnh Nghƒ©a Tools**
#### **3.1. T·∫°o Service v·ªõi @Tool**
```java
@Service
public class WeatherService {
    
    @Tool(description = "L·∫•y nhi·ªát ƒë·ªô theo th√†nh ph·ªë")
    public double getTemperature(@ToolParam("city") String city) {
        return weatherAPI.fetch(city).temp();
    }
}
```

#### **3.2. ƒêƒÉng K√Ω Tool Provider**
```java
@Bean
public ToolCallbackProvider weatherTools(WeatherService service) {
    return MethodToolCallbackProvider.builder()
        .toolObjects(service)
        .build();
}
```

---

### **4. Qu·∫£n L√Ω T√†i Nguy√™n (Resources)**
```java
@Bean
public List<McpServerFeatures.AsyncResourceSpecification> serverResources() {
    McpSchema.Resource systemInfo = new McpSchema.Resource(
        URI.create("system:info"),
        "Th√¥ng tin h·ªá th·ªëng",
        "Th√¥ng tin h·ªá th·ªëng ch·ªâ ƒë·ªçc"
    );
    
    return List.of(new McpServerFeatures.AsyncResourceSpecification(
        systemInfo,
        (exchange, request) -> Mono.fromCallable(() -> {
            Map<String, Object> info = Map.of(
                "os", System.getProperty("os.name"),
                "version", System.getProperty("os.version")
            );
            return new McpSchema.ReadResourceResult(
                List.of(new McpSchema.TextResourceContents(
                    request.uri(),
                    "application/json",
                    new ObjectMapper().writeValueAsString(info)
                ))
            );
        })
    ));
}
```

---

### **5. Prompt Templates**
```java
@Bean
public List<McpServerFeatures.SyncPromptSpecification> prompts() {
    McpSchema.Prompt greetingPrompt = new McpSchema.Prompt(
        "greeting",
        "T·∫°o l·ªùi ch√†o c√° nh√¢n h√≥a",
        List.of(new McpSchema.PromptArgument(
            "name", 
            "T√™n ng∆∞·ªùi d√πng", 
            true
        ))
    );
    
    return List.of(new McpServerFeatures.SyncPromptSpecification(
        greetingPrompt,
        (exchange, request) -> {
            String name = (String) request.arguments().get("name");
            return new GetPromptResult(
                "L·ªùi ch√†o c√° nh√¢n h√≥a",
                List.of(new PromptMessage(
                    Role.ASSISTANT,
                    new TextContent("Xin ch√†o " + name + "! T√¥i c√≥ th·ªÉ gi√∫p g√¨ b·∫°n?")
                ))
            );
        }
    ));
}
```

---

### **6. B·∫£o M·∫≠t**
#### **6.1. C·∫•u H√¨nh Security**
```java
@Configuration
@EnableWebFluxSecurity
public class SecurityConfig {
    
    @Bean
    public SecurityWebFilterChain securityFilterChain(ServerHttpSecurity http) {
        return http
            .authorizeExchange(exchanges -> exchanges
                .pathMatchers("/api/**").authenticated()
                .anyExchange().permitAll()
            )
            .httpBasic(withDefaults())
            .csrf(ServerHttpSecurity.CsrfSpec::disable)
            .build();
    }
}
```

#### **6.2. Validate Input**
```java
@Tool(description = "L·∫•y th√¥ng tin ng∆∞·ªùi d√πng")
public User getUser(@ToolParam("userId") @Min(1) Long userId) {
    // Logic
}
```

---

### **7. Gi√°m S√°t v√† Logging**
```java
@Bean
public McpAsyncServerCustomizer loggingCustomizer() {
    return (serverName, spec) -> {
        spec.loggingHandler((exchange, logMessage) -> {
            logger.info("[MCP] {} - {}", logMessage.level(), logMessage.message());
        });
    };
}
```

---

### **8. X·ª≠ L√Ω L·ªói**
```java
@Bean
public McpAsyncServerCustomizer errorHandler() {
    return (serverName, spec) -> {
        spec.errorHandler((exchange, error) -> {
            logger.error("L·ªói server MCP", error);
            return Mono.just(new McpSchema.ErrorResult(
                "LOI_HE_THONG", 
                "ƒê√£ x·∫£y ra l·ªói kh√¥ng mong mu·ªën"
            ));
        });
    };
}
```

---

### **9. Ki·ªÉm Th·ª≠**
```bash
# G·ª≠i y√™u c·∫ßu tool
curl -X POST http://localhost:8080/api/messages \
-H "Content-Type: application/json" \
-u user:password \
-d '{
    "tool": "getTemperature",
    "parameters": {"city": "Hanoi"}
}'
```

---

### **10. Best Practices**
- **Phi√™n b·∫£n h√≥a**: ƒê·∫∑t version cho tools v√† resources
- **T√°ch bi·ªát logic**: D√πng @Service cho business logic
- **T√†i li·ªáu h√≥a**: M√¥ t·∫£ r√µ parameters v√† return types
- **Gi√°m s√°t hi·ªáu nƒÉng**: T√≠ch h·ª£p v·ªõi Micrometer v√† Prometheus
- **Scale h·ªá th·ªëng**: S·ª≠ d·ª•ng Redis Cluster cho distributed caching

```java
// V√≠ d·ª• t√≠ch h·ª£p Redis
@Bean
public ReactiveRedisTemplate<String, Object> reactiveRedisTemplate(
    ReactiveRedisConnectionFactory factory) {
    return new ReactiveRedisTemplate<>(factory, RedisSerializationContext.json());
}
```

---

### **K·∫øt Lu·∫≠n**
V·ªõi MCP Server Boot Starter, b·∫°n c√≥ th·ªÉ:
- T·∫°o server MCP m·∫°nh m·∫Ω v·ªõi Spring Boot
- T√≠ch h·ª£p li·ªÅn m·∫π v·ªõi Spring AI Tool Framework
- Qu·∫£n l√Ω t√†i nguy√™n v√† prompt templates linh ho·∫°t
- D·ªÖ d√†ng m·ªü r·ªông v√† b·∫£o tr√¨

K·∫øt h·ª£p v·ªõi MCP Client ƒë·ªÉ x√¢y d·ª±ng h·ªá th·ªëng AI ph√¢n t√°n hi·ªáu qu·∫£! üöÄ