D∆∞·ªõi ƒë√¢y l√† h∆∞·ªõng d·∫´n chi ti·∫øt v√† h·ªá th·ªëng v·ªÅ c√°ch tri·ªÉn khai **Function nh∆∞ Tools** trong Spring AI, ƒë∆∞·ª£c tr√¨nh b√†y theo c√°ch d·ªÖ hi·ªÉu v√† c√≥ c·∫•u tr√∫c r√µ r√†ng:

---

### **1. Kh√°i ni·ªám C·ªët l√µi**
**Function nh∆∞ Tools** cho ph√©p b·∫°n bi·∫øn c√°c functional interfaces (Function, Supplier, Consumer, BiFunction) th√†nh c√°c c√¥ng c·ª• m√† AI Model c√≥ th·ªÉ g·ªçi. C√≥ 2 c√°ch tri·ªÉn khai ch√≠nh:
- **Programmatic**: T·∫°o tool tr·ª±c ti·∫øp b·∫±ng code v·ªõi `FunctionToolCallback`
- **Dynamic**: ƒê·ªãnh nghƒ©a tool qua Spring Bean, t·ª± ƒë·ªông resolve t·∫°i runtime

---

### **2. Tri·ªÉn khai Programmatic v·ªõi FunctionToolCallback**
#### **2.1. V√≠ d·ª• C∆° b·∫£n: L·∫•y Th√¥ng tin Th·ªùi ti·∫øt**
```java
// Step 1: ƒê·ªãnh nghƒ©a Function
public class WeatherService implements Function<WeatherRequest, WeatherResponse> {
    @Override
    public WeatherResponse apply(WeatherRequest request) {
        // Logic l·∫•y th√¥ng tin th·ªùi ti·∫øt
        return new WeatherResponse(28.5, Unit.C);
    }
}

// Step 2: T·∫°o ToolCallback
ToolCallback weatherTool = FunctionToolCallback.builder()
    .name("currentWeather")
    .description("L·∫•y nhi·ªát ƒë·ªô theo th√†nh ph·ªë")
    .toolFunction(new WeatherService())
    .inputType(WeatherRequest.class)
    .build();

// Step 3: S·ª≠ d·ª•ng trong ChatClient
String response = ChatClient.create(chatModel)
    .prompt("Nhi·ªát ƒë·ªô H√† N·ªôi l√† bao nhi√™u?")
    .tools(weatherTool)
    .call()
    .content();
```

#### **2.2. Gi·∫£i th√≠ch Tham s·ªë Quan tr·ªçng**
| Tham s·ªë | M√¥ t·∫£ | V√≠ d·ª• |
|---------|-------|-------|
| `name` | T√™n duy nh·∫•t ƒë·ªãnh danh tool | "currentWeather" |
| `description` | M√¥ t·∫£ ch·ª©c nƒÉng cho AI hi·ªÉu | "L·∫•y nhi·ªát ƒë·ªô theo th√†nh ph·ªë" |
| `inputType` | Ki·ªÉu d·ªØ li·ªáu ƒë·∫ßu v√†o | WeatherRequest.class |
| `toolMetadata` | C·∫•u h√¨nh metadata (returnDirect, v.v) | `ToolMetadata.builder().returnDirect(true).build()` |

---

### **3. Tri·ªÉn khai Dynamic v·ªõi Spring Bean**
#### **3.1. ƒê·ªãnh nghƒ©a Tool qua @Bean**
```java
@Configuration
public class ToolConfig {
    
    @Bean
    @Description("Chuy·ªÉn ƒë·ªïi ƒë∆°n v·ªã nhi·ªát ƒë·ªô")
    public Function<ConversionRequest, Double> temperatureConverter() {
        return request -> {
            if (request.fromUnit() == Unit.C && request.toUnit() == Unit.F) {
                return request.value() * 1.8 + 32;
            }
            // Th√™m c√°c ƒëi·ªÅu ki·ªán kh√°c
            return request.value();
        };
    }
}
```

#### **3.2. S·ª≠ d·ª•ng trong Chat Client**
```java
ChatClient.create(chatModel)
    .prompt("Chuy·ªÉn 25 ƒë·ªô C sang F")
    .tools("temperatureConverter") // T√™n Bean
    .call()
    .content();
```

---

### **4. X·ª≠ l√Ω D·ªØ li·ªáu Ph·ª©c t·∫°p**
#### **4.1. S·ª≠ d·ª•ng POJO v·ªõi @ToolParam**
```java
public record CurrencyConversionRequest(
    @ToolParam(description = "S·ªë ti·ªÅn") double amount,
    @ToolParam(description = "ƒê∆°n v·ªã g·ªëc (USD, VND)") String from,
    @ToolParam(description = "ƒê∆°n v·ªã ƒë√≠ch") String to
) {}

@Bean
@Description("Chuy·ªÉn ƒë·ªïi ti·ªÅn t·ªá")
public Function<CurrencyConversionRequest, Double> currencyConverter() {
    return request -> {
        // Logic chuy·ªÉn ƒë·ªïi
        return 23000.0; // V√≠ d·ª• USD -> VND
    };
}
```

#### **4.2. K·∫øt qu·∫£ Tr·∫£ v·ªÅ JSON**
```json
{
  "amount": 100,
  "from": "USD",
  "to": "VND",
  "converted": 2300000
}
```

---

### **5. C·∫•u h√¨nh N√¢ng Cao**
#### **5.1. Th√™m Tools M·∫∑c ƒë·ªãnh**
```java
// Th√™m v√†o ChatClient Builder
ChatClient.builder(chatModel)
    .defaultTools("currencyConverter", "temperatureConverter")
    .build();

// Th√™m v√†o ChatModel
OpenAiChatModel.builder()
    .defaultOptions(ToolCallingChatOptions.builder()
        .toolNames("weatherTool")
        .build())
    .build();
```

#### **5.2. Return Direct Result**
```java
ToolCallback directTool = FunctionToolCallback.builder()
    .name("directGreeting")
    .toolFunction((Supplier<String>) () -> "Xin ch√†o t·ª´ Tool!")
    .toolMetadata(ToolMetadata.builder().returnDirect(true).build())
    .build();
```

---

### **6. X·ª≠ l√Ω L·ªói v√† Debug**
#### **6.1. B·∫Øt Exceptions**
```java
try {
    ChatResponse response = ChatClient.create(chatModel)
        .tools(weatherTool)
        .call();
} catch (ToolExecutionException e) {
    System.err.println("L·ªói ·ªü tool: " + e.getToolName());
    e.printStackTrace();
}
```

#### **6.2. Logging v·ªõi AOP**
```java
@Aspect
@Component
public class ToolLogger {
    
    @Before("@within(org.springframework.ai.tool.annotation.Tool) || @annotation(org.springframework.ai.tool.annotation.Tool)")
    public void logToolCall(JoinPoint jp) {
        String toolName = jp.getSignature().getName();
        Object[] args = jp.getArgs();
        logger.info("Tool {} called with args: {}", toolName, Arrays.toString(args));
    }
}
```

---

### **7. Gi·ªõi h·∫°n v√† L∆∞u √ù**
#### **7.1. C√°c ki·ªÉu kh√¥ng h·ªó tr·ª£**
- **Primitive types**: S·ª≠ d·ª•ng wrapper classes (Integer thay int)
- **Collections**: D√πng POJO ch·ª©a collection
- **Reactive types**: Kh√¥ng d√πng Mono/Flux

#### **7.2. Best Practices**
- **M√¥ t·∫£ chi ti·∫øt**: Gi√∫p AI hi·ªÉu context
- **Validate input**: Tr√°nh SQL injection, XSS
- **Phi√™n b·∫£n h√≥a**: `v1_convertCurrency`, `v2_convertCurrency`

---

### **8. V√≠ d·ª• T·ªïng h·ª£p: H·ªá th·ªëng ƒê·∫∑t h√†ng**
```java
// Tool 1: Ki·ªÉm tra kho h√†ng
@Bean
@Description("Ki·ªÉm tra s·ªë l∆∞·ª£ng s·∫£n ph·∫©m trong kho")
public Function<ProductCheckRequest, Integer> checkInventory() {
    return request -> inventoryService.getStock(request.productId());
}

// Tool 2: T·∫°o ƒë∆°n h√†ng
@Bean
@Description("T·∫°o ƒë∆°n h√†ng m·ªõi")
public Function<OrderCreationRequest, String> createOrder() {
    return request -> orderService.createOrder(request);
}

// G·ªçi trong Chat
String response = ChatClient.create(chatModel)
    .prompt("ƒê·∫∑t 2 iPhone 15, ki·ªÉm tra kho tr∆∞·ªõc")
    .tools("checkInventory", "createOrder")
    .call()
    .content();
```

---

### **9. T√†i nguy√™n H·ªçc t·∫≠p**
1. [Spring AI Official Docs - Tool Calling](https://docs.spring.io/spring-ai/reference/api/tool-calling.html)
2. [GitHub Samples](https://github.com/spring-projects/spring-ai/tree/main/examples)
3. [JSON Schema for Tool Inputs](https://json-schema.org/)

---

**K·∫øt lu·∫≠n**: Qua c√°c v√≠ d·ª• v√† gi·∫£i th√≠ch tr√™n, b·∫°n ƒë√£ n·∫Øm ƒë∆∞·ª£c c√°ch tri·ªÉn khai Function nh∆∞ Tools trong Spring AI. H√£y b·∫Øt ƒë·∫ßu v·ªõi c√°c use case ƒë∆°n gi·∫£n, sau ƒë√≥ k·∫øt h·ª£p nhi·ªÅu tools ph·ª©c t·∫°p h∆°n. ƒê·ª´ng qu√™n test k·ªπ c√°c edge cases v√† lu√¥n validate input! üöÄ


---

<br><br>


# **Tool Specification**

D∆∞·ªõi ƒë√¢y l√† h∆∞·ªõng d·∫´n chi ti·∫øt v·ªÅ **Tool Specification** trong Spring AI, ƒë∆∞·ª£c tr√¨nh b√†y theo t·ª´ng ph·∫ßn v·ªõi v√≠ d·ª• minh h·ªça v√† gi·∫£i th√≠ch r√µ r√†ng:

---

### **1. C·∫•u Tr√∫c C·ªët L√µi: ToolCallback & ToolDefinition**
#### **1.1. ToolCallback Interface**
- **M·ª•c ƒë√≠ch**: ƒê·ªãnh nghƒ©a logic c·ªßa m·ªôt tool (c·∫£ metadata v√† execution)
- **C√°c ph∆∞∆°ng th·ª©c ch√≠nh**:
  ```java
  public interface ToolCallback {
      ToolDefinition getToolDefinition();  // ƒê·ªãnh nghƒ©a tool
      ToolMetadata getToolMetadata();      // Metadata x·ª≠ l√Ω
      String call(String toolInput);       // Th·ª±c thi tool
  }
  ```

#### **1.2. ToolDefinition Interface**
- **M·ª•c ƒë√≠ch**: M√¥ t·∫£ tool cho AI model
- **C√°c th√†nh ph·∫ßn**:
  ```java
  public interface ToolDefinition {
      String name();          // T√™n duy nh·∫•t
      String description();   // M√¥ t·∫£ ch·ª©c nƒÉng
      String inputSchema();   // JSON Schema cho input
  }
  ```

---

### **2. T·∫°o ToolDefinition T·ª´ Method**
#### **2.1. T·ª± ƒê·ªông Generate t·ª´ Method**
```java
public class DateTimeTools {
    
    @Tool(description = "L·∫•y th·ªùi gian hi·ªán t·∫°i")
    public String getCurrentTime() {
        return LocalDateTime.now().toString();
    }
}

// T·∫°o ToolDefinition t·ª´ method
Method method = ReflectionUtils.findMethod(DateTimeTools.class, "getCurrentTime");
ToolDefinition toolDef = ToolDefinition.from(method);
```

#### **2.2. Custom ToolDefinition b·∫±ng Builder**
```java
ToolDefinition customDef = ToolDefinition.builder()
    .name("currentTime")
    .description("Tr·∫£ v·ªÅ th·ªùi gian h·ªá th·ªëng")
    .inputSchema("""
        {
            "type": "object",
            "properties": {
                "timezone": {"type": "string"}
            },
            "required": []
        }
    """)
    .build();
```

---

### **3. JSON Schema v√† Custom Input**
#### **3.1. T·ª± ƒê·ªông Generate Schema**
Spring AI s·ª≠ d·ª•ng `JsonSchemaGenerator` ƒë·ªÉ t·∫°o schema t·ª´ POJO:
```java
public record WeatherRequest(
    @ToolParam(description = "T√™n th√†nh ph·ªë") String city,
    @ToolParam(description = "ƒê∆°n v·ªã nhi·ªát ƒë·ªô") Unit unit
) {}

// Generate schema
String schema = JsonSchemaGenerator.generateForType(WeatherRequest.class);
```

#### **3.2. Custom Schema v·ªõi Annotation**
```java
public class UserTools {
    
    @Tool(description = "C·∫≠p nh·∫≠t th√¥ng tin ng∆∞·ªùi d√πng")
    public void updateUser(
        @ToolParam(description = "ID ng∆∞·ªùi d√πng") Long id,
        @ToolParam(description = "T√™n ƒë·∫ßy ƒë·ªß") String fullName,
        @ToolParam(required = false, description = "Email") String email
    ) {
        // Logic c·∫≠p nh·∫≠t
    }
}
```
- **K·∫øt qu·∫£ Schema**:
  ```json
  {
    "type": "object",
    "properties": {
      "id": {"type": "integer"},
      "fullName": {"type": "string"},
      "email": {"type": "string"}
    },
    "required": ["id", "fullName"]
  }
  ```

---

### **4. X·ª≠ L√Ω Required/Optional Parameters**
#### **4.1. ƒê√°nh d·∫•u Tham s·ªë Kh√¥ng B·∫Øt Bu·ªôc**
```java
public class PaymentTools {
    
    @Tool(description = "T·∫°o thanh to√°n")
    public void createPayment(
        @ToolParam(description = "S·ªë ti·ªÅn") double amount,
        @ToolParam(required = false, description = "M√£ gi·∫£m gi√°") String coupon
    ) {
        // Logic thanh to√°n
    }
}
```

#### **4.2. C√°c Annotation H·ªó Tr·ª£**
- `@ToolParam(required = false)`
- `@Nullable` (Spring Framework)
- `@JsonProperty(required = false)` (Jackson)
- `@Schema(required = false)` (Swagger)

---

### **5. Tri·ªÉn Khai ToolCallback T√πy Ch·ªânh**
#### **5.1. V√≠ d·ª•: Tool G·ªçi API B√™n Ngo√†i**
```java
public class ExternalAPITool implements ToolCallback {

    @Override
    public ToolDefinition getToolDefinition() {
        return ToolDefinition.builder()
            .name("callExternalAPI")
            .description("G·ªçi REST API b√™n ngo√†i")
            .inputSchema("""
                {
                    "type": "object",
                    "properties": {
                        "url": {"type": "string"},
                        "method": {"type": "string", "enum": ["GET", "POST"]}
                    },
                    "required": ["url"]
                }
            """)
            .build();
    }

    @Override
    public String call(String input) {
        // Parse input JSON
        JsonNode params = new ObjectMapper().readTree(input);
        String url = params.get("url").asText();
        String method = params.path("method").asText("GET");
        
        // G·ªçi API
        return executeHttpRequest(url, method);
    }
}
```

---

### **6. Best Practices v√† L∆∞u √ù**
#### **6.1. ƒê·∫∑t T√™n v√† M√¥ T·∫£ R√µ R√†ng**
```java
@Tool(
    name = "v2_currencyConverter",
    description = "Chuy·ªÉn ƒë·ªïi ti·ªÅn t·ªá (phi√™n b·∫£n 2.0) - H·ªó tr·ª£ ƒëa qu·ªëc gia"
)
```

#### **6.2. Validate Input**
```java
public String call(String input) {
    JsonNode json = validateInput(input);
    // X·ª≠ l√Ω ti·∫øp
}

private JsonNode validateInput(String input) {
    try {
        JsonNode node = objectMapper.readTree(input);
        if (!node.has("amount")) {
            throw new IllegalArgumentException("Thi·∫øu tr∆∞·ªùng 'amount'");
        }
        return node;
    } catch (IOException e) {
        throw new ToolExecutionException("Input kh√¥ng h·ª£p l·ªá");
    }
}
```

#### **6.3. Logging v√† Monitoring**
```java
@Aspect
@Component
public class ToolMonitoringAspect {
    
    @Around("@within(org.springframework.ai.tool.annotation.Tool)")
    public Object logToolExecution(ProceedingJoinPoint pjp) throws Throwable {
        long start = System.currentTimeMillis();
        Object result = pjp.proceed();
        long duration = System.currentTimeMillis() - start;
        
        Metrics.counter("tool.executions").increment();
        Metrics.timer("tool.duration").record(duration, TimeUnit.MILLISECONDS);
        
        return result;
    }
}
```

---

### **7. V√≠ d·ª• T·ªïng H·ª£p: H·ªá Th·ªëng ƒê·∫∑t V√©**
#### **7.1. ƒê·ªãnh nghƒ©a Tool**
```java
public class BookingTools {
    
    @Tool(description = "Ki·ªÉm tra ch·ªó tr·ªëng tr√™n chuy·∫øn bay")
    public int checkFlightAvailability(
        @ToolParam(description = "M√£ chuy·∫øn bay") String flightCode,
        @ToolParam(description = "Ng√†y bay (yyyy-MM-dd)") String date
    ) {
        return flightService.getAvailableSeats(flightCode, date);
    }

    @Tool(description = "ƒê·∫∑t v√© m√°y bay", returnDirect = true)
    public String bookFlight(
        @ToolParam(description = "Th√¥ng tin ƒë·∫∑t v√©") BookingRequest request
    ) {
        String confirmation = bookingSystem.reserve(request);
        return "{\"status\": \"success\", \"confirmation\": \"" + confirmation + "\"}";
    }
}
```

#### **7.2. Schema T·ª± ƒê·ªông cho BookingRequest**
```java
public record BookingRequest(
    @ToolParam(description = "T√™n h√†nh kh√°ch") String passengerName,
    @ToolParam(description = "S·ªë gh·∫ø") String seatNumber,
    @ToolParam(description = "H·∫°ng v√©") SeatClass seatClass
) {}
```

---

### **8. Gi·ªõi H·∫°n v√† Kh·∫Øc Ph·ª•c**
#### **8.1. Ki·ªÉu D·ªØ Li·ªáu Kh√¥ng H·ªó Tr·ª£**
- **V·∫•n ƒë·ªÅ**: Kh√¥ng d√πng ƒë∆∞·ª£c `Optional`, `List`, reactive types
- **Gi·∫£i ph√°p**:
  ```java
  // Thay v√¨:
  public Optional<User> findUser(String id) {...}
  
  // D√πng:
  public User findUser(String id) {...} // Tr·∫£ null n·∫øu kh√¥ng t√¨m th·∫•y
  ```

#### **8.2. X·ª≠ L√Ω L·ªói Ph·ª©c T·∫°p**
```java
@Override
public String call(String input) {
    try {
        // X·ª≠ l√Ω ch√≠nh
    } catch (ExternalServiceException e) {
        throw new ToolExecutionException("L·ªói d·ªãch v·ª• b√™n ngo√†i", e, Map.of(
            "errorCode", e.getCode(),
            "retryable", true
        ));
    }
}
```

---

### **K·∫øt Lu·∫≠n**
Qua c√°c v√≠ d·ª• v√† gi·∫£i th√≠ch tr√™n:
1. **ToolCallback** l√† interface linh ho·∫°t ƒë·ªÉ ƒë·ªãnh nghƒ©a tool
2. **ToolDefinition** cung c·∫•p metadata quan tr·ªçng cho AI model
3. **JSON Schema** v√† annotation gi√∫p t√πy ch·ªânh input
4. Lu√¥n validate input v√† handle exceptions c·∫©n th·∫≠n

H√£y b·∫Øt ƒë·∫ßu v·ªõi c√°c tools ƒë∆°n gi·∫£n, sau ƒë√≥ k·∫øt h·ª£p nhi·ªÅu tools ph·ª©c t·∫°p h∆°n. S·ª≠ d·ª•ng logging v√† monitoring ƒë·ªÉ theo d√µi hi·ªáu su·∫•t! üöÄ

---
<br>
<br>

# **Result Conversion**,¬†**Tool Context**, v√†¬†**Return Direct**
D∆∞·ªõi ƒë√¢y l√† h∆∞·ªõng d·∫´n chi ti·∫øt v·ªÅ **Result Conversion**, **Tool Context**, v√† **Return Direct** trong Spring AI, ƒë∆∞·ª£c tr√¨nh b√†y qua c√°c ph·∫ßn ch√≠nh v·ªõi v√≠ d·ª• minh h·ªça:

---

### **1. Result Conversion - Chuy·ªÉn ƒê·ªïi K·∫øt Qu·∫£**
#### **1.1. ToolCallResultConverter Interface**
- **M·ª•c ƒë√≠ch**: Chuy·ªÉn ƒë·ªïi k·∫øt qu·∫£ t·ª´ tool th√†nh chu·ªói ƒë·ªÉ g·ª≠i l·∫°i AI Model.
- **C·∫•u tr√∫c**:
  ```java
  public interface ToolCallResultConverter {
      String convert(@Nullable Object result, @Nullable Type returnType);
  }
  ```
- **M·∫∑c ƒë·ªãnh**: D√πng Jackson ƒë·ªÉ serialize th√†nh JSON.

#### **1.2. V√≠ d·ª• T√πy Ch·ªânh Converter**
```java
// Custom Converter cho XML
public class XmlResultConverter implements ToolCallResultConverter {
    @Override
    public String convert(Object result, Type returnType) {
        try {
            XmlMapper xmlMapper = new XmlMapper();
            return xmlMapper.writeValueAsString(result);
        } catch (JsonProcessingException e) {
            throw new RuntimeException("L·ªói chuy·ªÉn ƒë·ªïi XML", e);
        }
    }
}

// √Åp d·ª•ng cho method tool
@Tool(description = "L·∫•y th√¥ng tin s·∫£n ph·∫©m", resultConverter = XmlResultConverter.class)
public Product getProduct(String id) {
    return productService.findById(id);
}
```

---

### **2. Tool Context - Truy·ªÅn Th√¥ng Tin B·ªï Sung**
#### **2.1. S·ª≠ d·ª•ng ToolContext**
- **M·ª•c ƒë√≠ch**: Truy·ªÅn d·ªØ li·ªáu kh√¥ng g·ª≠i ƒë·∫øn AI Model (VD: tenantId, auth token).
- **V√≠ d·ª•**:
  ```java
  @Tool(description = "L·∫•y th√¥ng tin kh√°ch h√†ng")
  public Customer getCustomer(Long id, ToolContext context) {
      String tenant = context.get("tenantId");
      return customerRepo.findByTenant(id, tenant);
  }

  // G·ªçi tool v·ªõi context
  ChatClient.create(chatModel)
      .prompt("Th√¥ng tin kh√°ch h√†ng ID 123")
      .tools(new CustomerTools())
      .toolContext(Map.of("tenantId", "acme_corp"))
      .call();
  ```

#### **2.2. Merge Context**
- **Default + Runtime Context**: Runtime context ghi ƒë√® l√™n default.
  ```java
  // C·∫•u h√¨nh default
  ChatModel model = OpenAiChatModel.builder()
      .defaultOptions(ToolCallingChatOptions.builder()
          .toolContext(Map.of("env", "prod"))
          .build())
      .build();

  // Runtime context
  ChatOptions options = ToolCallingChatOptions.builder()
      .toolContext(Map.of("env", "staging")) // Ghi ƒë√® "prod" -> "staging"
      .build();
  ```

---

### **3. Return Direct - Tr·∫£ K·∫øt Qu·∫£ Tr·ª±c Ti·∫øp**
#### **3.1. K√≠ch Ho·∫°t Return Direct**
- **Khi n√†o d√πng**: K·∫øt qu·∫£ tool c·∫ßn tr·∫£ th·∫≥ng v·ªÅ client (kh√¥ng qua AI Model x·ª≠ l√Ω ti·∫øp).
- **V√≠ d·ª• Method Tool**:
  ```java
  @Tool(description = "T√≠nh to√°n l∆∞∆°ng", returnDirect = true)
  public SalaryReport calculateSalary(Employee employee) {
      return payrollService.calculate(employee);
  }
  ```

- **V√≠ d·ª• Function Tool**:
  ```java
  // T·∫°o ToolMetadata v·ªõi returnDirect
  ToolMetadata metadata = ToolMetadata.builder().returnDirect(true).build();

  // √Åp d·ª•ng cho FunctionToolCallback
  ToolCallback tool = FunctionToolCallback.builder()
      .name("calculateTax")
      .toolFunction(taxCalculator)
      .toolMetadata(metadata)
      .build();
  ```

#### **3.2. L∆∞u √Ω Khi D√πng Nhi·ªÅu Tools**
- **T·∫•t c·∫£ tools ph·∫£i returnDirect=true** ƒë·ªÉ tr·∫£ k·∫øt qu·∫£ tr·ª±c ti·∫øp:
  ```java
  @Tool(description = "Tool A", returnDirect = true)
  public String toolA() { ... }

  @Tool(description = "Tool B", returnDirect = true) // B·∫Øt bu·ªôc c√πng returnDirect
  public String toolB() { ... }
  ```

---

### **4. Best Practices & X·ª≠ L√Ω L·ªói**
#### **4.1. Validate Input**
```java
@Tool(description = "Chuy·ªÉn ƒë·ªïi ti·ªÅn t·ªá")
public double convertCurrency(
    @ToolParam(description = "S·ªë ti·ªÅn") double amount,
    @ToolParam(description = "M√£ ngu·ªìn") String from,
    @ToolParam(description = "M√£ ƒë√≠ch") String to
) {
    if (amount <= 0) throw new IllegalArgumentException("S·ªë ti·ªÅn kh√¥ng h·ª£p l·ªá");
    if (!isValidCurrencyCode(from)) throw new IllegalArgumentException("M√£ ngu·ªìn sai");
    // Logic chuy·ªÉn ƒë·ªïi...
}
```

#### **4.2. Logging & Monitoring**
```java
@Aspect
@Component
public class ToolLogger {
    
    @Around("@annotation(org.springframework.ai.tool.annotation.Tool)")
    public Object logExecution(ProceedingJoinPoint jp) throws Throwable {
        String toolName = jp.getSignature().getName();
        logger.info("B·∫Øt ƒë·∫ßu tool: {}", toolName);
        
        long start = System.currentTimeMillis();
        Object result = jp.proceed();
        long duration = System.currentTimeMillis() - start;
        
        logger.info("Ho√†n th√†nh tool {} trong {}ms", toolName, duration);
        return result;
    }
}
```

---

### **5. V√≠ d·ª• T·ªïng H·ª£p: H·ªá Th·ªëng H·ªó Tr·ª£ Kh√°ch H√†ng**
#### **5.1. ƒê·ªãnh nghƒ©a Tools**
```java
public class SupportTools {
    
    @Tool(description = "T√¨m ki·∫øm ticket h·ªó tr·ª£", returnDirect = true)
    public List<Ticket> searchTickets(
        @ToolParam(description = "T·ª´ kh√≥a") String keyword,
        ToolContext context
    ) {
        String agentId = context.get("agentId");
        return ticketService.search(keyword, agentId);
    }

    @Tool(description = "C·∫≠p nh·∫≠t tr·∫°ng th√°i ticket")
    public void updateTicketStatus(
        @ToolParam(description = "Ticket ID") String ticketId,
        @ToolParam(description = "Tr·∫°ng th√°i m·ªõi") String status
    ) {
        ticketService.updateStatus(ticketId, status);
    }
}
```

#### **5.2. G·ªçi Tool v·ªõi Context**
```java
ChatResponse response = ChatClient.create(chatModel)
    .prompt("T√¨m c√°c ticket li√™n quan ƒë·∫øn 'thanh to√°n'")
    .tools(new SupportTools())
    .toolContext(Map.of("agentId", "agent_123"))
    .call();

// K·∫øt qu·∫£ tr·∫£ th·∫≥ng t·ª´ searchTickets
System.out.println(response.getContent()); 
```

---

### **K·∫øt Lu·∫≠n**
- **Result Conversion**: Linh ho·∫°t chuy·ªÉn ƒë·ªïi ƒë·ªãnh d·∫°ng k·∫øt qu·∫£ (JSON/XML/CSV).
- **Tool Context**: Truy·ªÅn th√¥ng tin b·∫£o m·∫≠t/n·ªôi b·ªô m√† kh√¥ng g·ª≠i ƒë·∫øn AI.
- **Return Direct**: T·ªëi ∆∞u h√≥a lu·ªìng x·ª≠ l√Ω khi kh√¥ng c·∫ßn AI x·ª≠ l√Ω ti·∫øp.
- **L∆∞u √Ω**: Lu√¥n validate input, log chi ti·∫øt, v√† x·ª≠ l√Ω ngo·∫°i l·ªá c·∫©n th·∫≠n.

√Åp d·ª•ng c√°c k·ªπ thu·∫≠t n√†y gi√∫p x√¢y d·ª±ng h·ªá th·ªëng AI m·∫°nh m·∫Ω, linh ho·∫°t v√† b·∫£o m·∫≠t! üöÄ