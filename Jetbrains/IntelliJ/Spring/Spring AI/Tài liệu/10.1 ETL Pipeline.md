Äá»ƒ triá»ƒn khai **ETL Pipeline** trong Spring AI, hÃ£y lÃ m theo cÃ¡c bÆ°á»›c chi tiáº¿t sau:

---

### **1. Tá»•ng Quan ETL Pipeline**
ETL (Extract, Transform, Load) giÃºp xá»­ lÃ½ dá»¯ liá»‡u tá»« nguá»“n thÃ´ sang Ä‘á»‹nh dáº¡ng phÃ¹ há»£p cho AI Model. Cáº¥u trÃºc gá»“m:
- **DocumentReader**: TrÃ­ch xuáº¥t dá»¯ liá»‡u tá»« cÃ¡c nguá»“n (PDF, HTML, JSON, v.v.).
- **DocumentTransformer**: Biáº¿n Ä‘á»•i dá»¯ liá»‡u (chia nhá», thÃªm metadata).
- **DocumentWriter**: LÆ°u dá»¯ liá»‡u vÃ o vector store hoáº·c file.

---

### **2. Triá»ƒn Khai DocumentReader**
#### **2.1. Äá»c PDF**:
```java
// ThÃªm dependency
<dependency>
    <groupId>org.springframework.ai</groupId>
    <artifactId>spring-ai-pdf-document-reader</artifactId>
</dependency>

// Code
PagePdfDocumentReader pdfReader = new PagePdfDocumentReader(
    "classpath:sample.pdf",
    PdfDocumentReaderConfig.builder()
        .withPagesPerDocument(1) // 1 trang/doc
        .build()
);
List<Document> documents = pdfReader.read();
```

#### **2.2. Äá»c HTML (JSoup)**:
```java
// ThÃªm dependency
<dependency>
    <groupId>org.springframework.ai</groupId>
    <artifactId>spring-ai-jsoup-document-reader</artifactId>
</dependency>

// Code
JsoupDocumentReaderConfig config = JsoupDocumentReaderConfig.builder()
    .selector("article p") // Chá»n cÃ¡c Ä‘oáº¡n trong tháº» <article>
    .metadataTags(List.of("author", "date")) // TrÃ­ch metadata tá»« tháº» meta
    .build();
JsoupDocumentReader htmlReader = new JsoupDocumentReader(new ClassPathResource("page.html"), config);
List<Document> htmlDocs = htmlReader.read();
```

---

### **3. Triá»ƒn Khai DocumentTransformer**
#### **3.1. Chia Nhá» VÄƒn Báº£n**:
```java
TokenTextSplitter splitter = new TokenTextSplitter(
    1000, // Sá»‘ token má»—i chunk
    200,  // Sá»‘ kÃ½ tá»± tá»‘i thiá»ƒu
    10    // Äá»™ dÃ i tá»‘i thiá»ƒu Ä‘á»ƒ giá»¯ láº¡i
);
List<Document> splitDocs = splitter.apply(documents);
```

#### **3.2. ThÃªm Metadata**:
```java
// Sá»­ dá»¥ng ChatModel (vÃ­ dá»¥: OpenAI) Ä‘á»ƒ sinh tá»« khÃ³a
@Autowired
private ChatModel chatModel;

KeywordMetadataEnricher enricher = new KeywordMetadataEnricher(chatModel, 5); // 5 tá»« khÃ³a/doc
List<Document> enrichedDocs = enricher.apply(splitDocs);
```

---

### **4. Triá»ƒn Khai DocumentWriter**
#### **4.1. Ghi vÃ o Vector Store**:
```java
// ThÃªm dependency (vÃ­ dá»¥: PostgreSQL)
<dependency>
    <groupId>org.springframework.ai</groupId>
    <artifactId>spring-ai-postgresql-spring-boot-starter</artifactId>
</dependency>

// Code
@Autowired
private VectorStore vectorStore;

vectorStore.add(enrichedDocs);
```

#### **4.2. Ghi Ra File**:
```java
FileDocumentWriter fileWriter = new FileDocumentWriter(
    "output.txt",
    true,   // ThÃªm marker cho má»—i document
    MetadataMode.ALL, // Ghi cáº£ metadata
    false   // Ghi Ä‘Ã¨ file náº¿u tá»“n táº¡i
);
fileWriter.write(enrichedDocs);
```

---

### **5. VÃ­ Dá»¥ HoÃ n Chá»‰nh**
```java
@SpringBootApplication
public class EtlApplication {

    public static void main(String[] args) {
        SpringApplication.run(EtlApplication.class, args);
    }

    @Bean
    public CommandLineRunner run(
        PagePdfDocumentReader pdfReader,
        TokenTextSplitter splitter,
        KeywordMetadataEnricher enricher,
        VectorStore vectorStore
    ) {
        return args -> {
            // Extract
            List<Document> rawDocs = pdfReader.read();
            
            // Transform
            List<Document> splitDocs = splitter.apply(rawDocs);
            List<Document> enrichedDocs = enricher.apply(splitDocs);
            
            // Load
            vectorStore.add(enrichedDocs);
            System.out.println("ÄÃ£ lÆ°u " + enrichedDocs.size() + " documents vÃ o vector store!");
        };
    }
}
```

---

### **6. Cáº¥u HÃ¬nh Trong `application.properties`**
```properties
# Vector Store (PostgreSQL)
spring.datasource.url=jdbc:postgresql://localhost:5432/vectordb
spring.datasource.username=user
spring.datasource.password=pass

# OpenAI (cho MetadataEnricher)
spring.ai.openai.api-key=${OPENAI_KEY}
```

---

### **7. Best Practices**
- **Xá»­ LÃ½ Lá»—i**: Báº¯t ngoáº¡i lá»‡ khi Ä‘á»c/ghi file.
- **Quáº£n LÃ½ Token**: Theo dÃµi token usage qua `ChatResponse.getMetadata()`.
- **Tá»‘i Æ¯u Hiá»‡u Suáº¥t**: Sá»­ dá»¥ng batch processing cho dá»¯ liá»‡u lá»›n.

---

### **Káº¿t Luáº­n**
ETL Pipeline trong Spring AI cung cáº¥p:
- **Linh hoáº¡t**: Há»— trá»£ Ä‘a dáº¡ng Ä‘á»‹nh dáº¡ng Ä‘áº§u vÃ o.
- **Máº¡nh máº½**: TÃ­ch há»£p AI Ä‘á»ƒ lÃ m giÃ u metadata.
- **Dá»… má»Ÿ rá»™ng**: TÃ­ch há»£p vá»›i nhiá»u vector store.

Báº¯t Ä‘áº§u vá»›i vÃ­ dá»¥ Ä‘Æ¡n giáº£n vÃ  Ä‘iá»u chá»‰nh tá»«ng bÆ°á»›c Ä‘á»ƒ tá»‘i Æ°u cho use case cá»§a báº¡n! ğŸš€