Äá»ƒ sá»­ dá»¥ng **Structured Output Converter** trong Spring AI, hÃ£y lÃ m theo cÃ¡c bÆ°á»›c chi tiáº¿t sau:

---

### **1. Tá»•ng Quan**
**Structured Output Converter** giÃºp chuyá»ƒn Ä‘á»•i Ä‘áº§u ra cá»§a AI Model sang Ä‘á»‹nh dáº¡ng cáº¥u trÃºc (JSON, List, Map, POJO). CÃ³ cÃ¡c loáº¡i converter chÃ­nh:
- **BeanOutputConverter**: Chuyá»ƒn Ä‘á»•i sang Java Bean/Record.
- **MapOutputConverter**: Chuyá»ƒn Ä‘á»•i sang Map.
- **ListOutputConverter**: Chuyá»ƒn Ä‘á»•i sang List.

---

### **2. BeanOutputConverter**
**Má»¥c Ä‘Ã­ch**: Ãnh xáº¡ Ä‘áº§u ra AI sang Java Object.

**VÃ­ dá»¥ vá»›i Record**:
```java
record ActorFilms(String actor, List<String> movies) {}

// Sá»­ dá»¥ng ChatClient
ActorFilms result = ChatClient.create(chatModel)
    .prompt()
    .user(u -> u.text("Liá»‡t kÃª 5 phim cá»§a {actor}").param("actor", "Tom Hanks"))
    .call()
    .entity(ActorFilms.class);

// Hoáº·c thá»§ cÃ´ng
BeanOutputConverter<ActorFilms> converter = new BeanOutputConverter<>(ActorFilms.class);
String format = converter.getFormat(); // Láº¥y JSON Schema

Prompt prompt = new Prompt(
    new UserMessage("Liá»‡t kÃª 5 phim cá»§a Tom Hanks. Äá»‹nh dáº¡ng: " + format)
);

ChatResponse response = chatModel.call(prompt);
ActorFilms actorFilms = converter.convert(response.getResult().getOutput().getContent());
```

**LÆ°u Ã½**:
- ThÃªm `@JsonPropertyOrder` Ä‘á»ƒ kiá»ƒm soÃ¡t thá»© tá»± trÆ°á»ng trong JSON Schema.
- Sá»­ dá»¥ng `ParameterizedTypeReference` cho generic types.

---

### **3. MapOutputConverter**
**Má»¥c Ä‘Ã­ch**: Chuyá»ƒn Ä‘á»•i Ä‘áº§u ra AI sang Map.

**VÃ­ dá»¥**:
```java
// Sá»­ dá»¥ng ChatClient
Map<String, Object> result = ChatClient.create(chatModel)
    .prompt()
    .user("Liá»‡t kÃª sá»‘ tá»« 1 Ä‘áº¿n 9 dÆ°á»›i key 'numbers'")
    .call()
    .entity(new ParameterizedTypeReference<Map<String, Object>>() {});

// Hoáº·c thá»§ cÃ´ng
MapOutputConverter converter = new MapOutputConverter();
String format = converter.getFormat(); // "JSON format..."

Prompt prompt = new Prompt(new UserMessage("Liá»‡t kÃª sá»‘ tá»« 1 Ä‘áº¿n 9. Äá»‹nh dáº¡ng: " + format));
ChatResponse response = chatModel.call(prompt);
Map<String, Object> mapResult = converter.convert(response.getResult().getOutput().getContent());
```

---

### **4. ListOutputConverter**
**Má»¥c Ä‘Ã­ch**: Chuyá»ƒn Ä‘á»•i Ä‘áº§u ra AI sang List.

**VÃ­ dá»¥**:
```java
// Sá»­ dá»¥ng ChatClient
List<String> flavors = ChatClient.create(chatModel)
    .prompt()
    .user("Liá»‡t kÃª 5 hÆ°Æ¡ng vá»‹ kem")
    .call()
    .entity(new ListOutputConverter(new DefaultConversionService()));

// Hoáº·c thá»§ cÃ´ng
ListOutputConverter converter = new ListOutputConverter(new DefaultConversionService());
String format = converter.getFormat(); // "Comma-separated list..."

Prompt prompt = new Prompt(new UserMessage("Liá»‡t kÃª 5 hÆ°Æ¡ng vá»‹ kem. Äá»‹nh dáº¡ng: " + format));
ChatResponse response = chatModel.call(prompt);
List<String> list = converter.convert(response.getResult().getOutput().getContent());
```

---

### **5. Cáº¥u HÃ¬nh Model Há»— Trá»£ JSON**
Má»™t sá»‘ model há»— trá»£ cháº¿ Ä‘á»™ JSON built-in. VÃ­ dá»¥ vá»›i **OpenAI**:
```java
// Báº­t JSON mode
OpenAiChatOptions options = OpenAiChatOptions.builder()
    .model("gpt-4o")
    .responseFormat(new ResponseFormat(ResponseFormat.Type.JSON_OBJECT))
    .build();

Prompt prompt = new Prompt("Liá»‡t kÃª 5 phim cá»§a Tom Hanks dáº¡ng JSON", options);
ChatResponse response = chatModel.call(prompt);
```

---

### **6. Xá»­ LÃ½ Lá»—i & Best Practices**
- **Validation**: Kiá»ƒm tra dá»¯ liá»‡u Ä‘áº§u ra trÆ°á»›c khi sá»­ dá»¥ng.
- **Retry**: Sá»­ dá»¥ng retry mechanism khi model khÃ´ng tráº£ vá» Ä‘Ãºng Ä‘á»‹nh dáº¡ng.
- **Logging**: Ghi log Ä‘áº§u vÃ o/ra Ä‘á»ƒ debug.

**VÃ­ dá»¥ validation**:
```java
try {
    ActorFilms result = converter.convert(response.getContent());
    if (result.movies().size() < 5) {
        throw new IllegalStateException("KhÃ´ng Ä‘á»§ sá»‘ lÆ°á»£ng phim");
    }
} catch (JsonProcessingException e) {
    logger.error("Lá»—i parse JSON", e);
}
```

---

### **Káº¿t Luáº­n**
Structured Output Converter trong Spring AI giÃºp:
- **Chuáº©n hÃ³a Ä‘áº§u ra**: Äáº£m báº£o dá»¯ liá»‡u nháº¥t quÃ¡n.
- **Tiáº¿t kiá»‡m thá»i gian**: Tá»± Ä‘á»™ng Ã¡nh xáº¡ sang POJO/Collection.
- **Linh hoáº¡t**: Há»— trá»£ nhiá»u Ä‘á»‹nh dáº¡ng vÃ  model.

Báº¯t Ä‘áº§u vá»›i cÃ¡c vÃ­ dá»¥ Ä‘Æ¡n giáº£n vÃ  tÃ¹y chá»‰nh theo nhu cáº§u á»©ng dá»¥ng cá»§a báº¡n! ğŸš€