ƒê·ªÉ t√≠ch h·ª£p **OpenAI Chat** v√†o ·ª©ng d·ª•ng Spring AI, h√£y l√†m theo c√°c b∆∞·ªõc chi ti·∫øt sau:

---

### **1. Thi·∫øt L·∫≠p M√¥i Tr∆∞·ªùng**
1. **T·∫°o API Key tr√™n OpenAI**:
   - ƒêƒÉng k√Ω t√†i kho·∫£n t·∫°i [OpenAI](https://platform.openai.com/signup).
   - T·∫°o API Key t·ª´ trang [API Keys](https://platform.openai.com/api-keys).

2. **Th√™m Dependency v√†o Project**:
   ```xml
   <dependency>
       <groupId>org.springframework.ai</groupId>
       <artifactId>spring-ai-starter-model-openai</artifactId>
   </dependency>
   ```

3. **C·∫•u H√¨nh Trong `application.properties`**:
   ```properties
   # OpenAI API Key
   spring.ai.openai.api-key=${OPENAI_API_KEY}

   # Model Settings
   spring.ai.model.chat=openai
   spring.ai.openai.chat.options.model=gpt-4o
   spring.ai.openai.chat.options.temperature=0.7
   ```

---

### **2. Tri·ªÉn Khai ChatClient**
#### **2.1. Chat ƒê·ªìng B·ªô**:
```java
@RestController
public class ChatController {
    private final ChatClient chatClient;

    @Autowired
    public ChatController(ChatClient.Builder builder) {
        this.chatClient = builder.build();
    }

    @GetMapping("/chat")
    public String chat(@RequestParam String message) {
        return chatClient.prompt(message).call().content();
    }
}
```

#### **2.2. Streaming**:
```java
@GetMapping("/chat/stream")
public Flux<String> streamChat(@RequestParam String message) {
    return chatClient.prompt(message).stream().content();
}
```

---

### **3. G·ªçi H√†m (Function Calling)**
**ƒê·ªãnh Nghƒ©a H√†m**:
```java
public class WeatherService {
    @Tool(description = "Get the weather in location")
    public String getWeather(@ToolParam(description = "City name") String city) {
        return "Sunny, 25¬∞C in " + city;
    }
}
```

**S·ª≠ D·ª•ng**:
```java
@Autowired
private WeatherService weatherService;

@GetMapping("/weather")
public String getWeather(@RequestParam String city) {
    return ChatClient.create(chatModel)
        .prompt("What's the weather in " + city + "?")
        .tools(weatherService)
        .call()
        .content();
}
```

---

### **4. X·ª≠ L√Ω ƒêa Ph∆∞∆°ng Th·ª©c (Multimodal)**
#### **X·ª≠ L√Ω H√¨nh ·∫¢nh**:
```java
@GetMapping("/analyze-image")
public String analyzeImage() {
    var imageResource = new ClassPathResource("/test.png");
    return ChatClient.create(chatModel)
        .prompt()
        .user(u -> u.text("Describe this image")
            .media(Media.Format.IMAGE_PNG, imageResource))
        .call()
        .content();
}
```

#### **X·ª≠ L√Ω Audio**:
```java
@GetMapping("/analyze-audio")
public String analyzeAudio() {
    var audioResource = new ClassPathResource("audio.mp3");
    return ChatClient.create(chatModel)
        .prompt()
        .user(u -> u.text("Summarize this audio")
            .media(Media.Format.AUDIO_MP3, audioResource))
        .call()
        .content();
}
```

---

### **5. Structured Outputs (JSON Schema)**
**ƒê·ªãnh Nghƒ©a Schema**:
```java
record MathSolution(List<Step> steps, String finalAnswer) {
    record Step(String explanation, String output) {}
}

var outputConverter = new BeanOutputConverter<>(MathSolution.class);
String jsonSchema = outputConverter.getJsonSchema();
```

**S·ª≠ D·ª•ng**:
```java
@GetMapping("/solve-equation")
public MathSolution solveEquation(@RequestParam String equation) {
    var prompt = new Prompt(
        "Solve: " + equation,
        OpenAiChatOptions.builder()
            .model("gpt-4o")
            .responseFormat(new ResponseFormat(ResponseFormat.Type.JSON_SCHEMA, jsonSchema))
            .build()
    );

    ChatResponse response = chatModel.call(prompt);
    return outputConverter.convert(response.getResult().getOutput().getContent());
}
```

---

### **6. C·∫•u H√¨nh Retry & Security**
#### **Retry**:
```properties
spring.ai.retry.max-attempts=5
spring.ai.retry.backoff.initial-interval=3s
```

#### **Security**:
- **Kh√¥ng hardcode API Key**: S·ª≠ d·ª•ng bi·∫øn m√¥i tr∆∞·ªùng ho·∫∑c vault.
- **X·ª≠ l√Ω l·ªói**:
  ```java
  try {
      chatModel.call(prompt);
  } catch (AiClientException e) {
      logger.error("OpenAI Error: {}", e.getMessage());
  }
  ```

---

### **7. So S√°nh Model**
| **Model**      | **T√≠nh NƒÉng**           | **Streaming** | **Multimodal** |
|----------------|-------------------------|---------------|----------------|
| **GPT-4o**     | ƒêa ph∆∞∆°ng th·ª©c, Function Calling | ‚úîÔ∏è            | ‚úîÔ∏è (H√¨nh ·∫£nh, audio) |
| **GPT-3.5**    | Text, Function Calling  | ‚úîÔ∏è            | ‚ùå             |

---

### **Best Practices**
- **T·ªëi ∆Øu Token**: Gi√°m s√°t qua `ChatResponse.getMetadata().getUsage()`.
- **Ki·ªÉm Tra Gi·ªõi H·∫°n**: OpenAI c√≥ rate limits, c·∫ßn x·ª≠ l√Ω qua retry.
- **Phi√™n B·∫£n Model**: Lu√¥n c·∫≠p nh·∫≠t model m·ªõi nh·∫•t (v√≠ d·ª•: `gpt-4o` thay v√¨ `gpt-4`).

---

### **K·∫øt Lu·∫≠n**
Spring AI gi√∫p t√≠ch h·ª£p OpenAI d·ªÖ d√†ng v·ªõi:
- **Chat ƒëa ph∆∞∆°ng th·ª©c**: X·ª≠ l√Ω h√¨nh ·∫£nh, audio, text.
- **G·ªçi h√†m linh ho·∫°t**: K·∫øt h·ª£p logic nghi·ªáp v·ª•.
- **Structured Outputs**: ƒê·∫£m b·∫£o d·ªØ li·ªáu ƒë·∫ßu ra chu·∫©n.

B·∫Øt ƒë·∫ßu v·ªõi v√≠ d·ª• ƒë∆°n gi·∫£n v√† m·ªü r·ªông d·∫ßn ƒë·ªÉ t·∫≠n d·ª•ng t·ªëi ƒëa s·ª©c m·∫°nh c·ªßa AI! üöÄ