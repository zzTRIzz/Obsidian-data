D∆∞·ªõi ƒë√¢y l√† h∆∞·ªõng d·∫´n chi ti·∫øt v·ªÅ **Model Context Protocol (MCP)** trong Spring AI v√† c√°ch t√≠ch h·ª£p v√†o ·ª©ng d·ª•ng:

---

### **1. T·ªïng Quan v·ªÅ MCP**
#### **1.1. M·ª•c ƒê√≠ch**
- **Chu·∫©n h√≥a t∆∞∆°ng t√°c**: Cho ph√©p AI Model giao ti·∫øp v·ªõi c√¥ng c·ª•/t√†i nguy√™n b√™n ngo√†i qua JSON-RPC.
- **H·ªó tr·ª£ ƒëa n·ªÅn t·∫£ng**: L√†m vi·ªác v·ªõi c·∫£ ·ª©ng d·ª•ng standalone v√† h·ªá th·ªëng ph√¢n t√°n.
- **T√≠ch h·ª£p Spring Boot**: D·ªÖ d√†ng tri·ªÉn khai qua c√°c starter.

#### **1.2. Ki·∫øn Tr√∫c MCP Java SDK**
| **L·ªõp**          | **M√¥ T·∫£**                                                                 |
|-------------------|---------------------------------------------------------------------------|
| **Client/Server** | `McpClient` (x·ª≠ l√Ω k·∫øt n·ªëi) v√† `McpServer` (cung c·∫•p d·ªãch v·ª•)             |
| **Session**       | `McpSession` qu·∫£n l√Ω tr·∫°ng th√°i v√† giao ti·∫øp (m·∫∑c ƒë·ªãnh: `DefaultMcpSession`) |
| **Transport**     | X·ª≠ l√Ω serialization/deserialization message (Stdio, HTTP SSE, WebFlux SSE) |

---

### **2. Tri·ªÉn Khai MCP Client**
#### **2.1. Th√™m Dependency**
```xml
<!-- Core MCP Client -->
<dependency>
    <groupId>org.springframework.ai</groupId>
    <artifactId>spring-ai-starter-mcp-client</artifactId>
</dependency>

<!-- WebFlux SSE Transport -->
<dependency>
    <groupId>org.springframework.ai</groupId>
    <artifactId>spring-ai-starter-mcp-client-webflux</artifactId>
</dependency>
```

#### **2.2. C·∫•u H√¨nh Client**
```java
@Configuration
public class McpClientConfig {
    
    @Bean
    public McpClient mcpClient() {
        return McpClient.builder()
            .transport(new WebFluxSseTransport("http://localhost:8080/mcp"))
            .build();
    }
}
```

#### **2.3. G·ªçi Tool t·ª´ MCP Client**
```java
@Autowired
private McpClient mcpClient;

public void callWeatherTool() {
    McpRequest request = McpRequest.createToolCall("getWeather", Map.of("city", "Hanoi"));
    McpResponse response = mcpClient.send(request).block();
    System.out.println("K·∫øt qu·∫£: " + response.getResult());
}
```

---

### **3. Tri·ªÉn Khai MCP Server**
#### **3.1. Th√™m Dependency**
```xml
<!-- Core MCP Server -->
<dependency>
    <groupId>org.springframework.ai</groupId>
    <artifactId>spring-ai-starter-mcp-server</artifactId>
</dependency>

<!-- WebMVC SSE Transport -->
<dependency>
    <groupId>org.springframework.ai</groupId>
    <artifactId>spring-ai-starter-mcp-server-webmvc</artifactId>
</dependency>
```

#### **3.2. ƒêƒÉng K√Ω Tool tr√™n Server**
```java
@Configuration
public class McpServerConfig {
    
    @Bean
    public McpTool weatherTool() {
        return McpTool.builder()
            .name("getWeather")
            .description("L·∫•y th√¥ng tin th·ªùi ti·∫øt")
            .function((Map<String, Object> params) -> {
                String city = (String) params.get("city");
                return weatherService.getWeather(city);
            })
            .build();
    }
}
```

#### **3.3. Kh·ªüi ƒê·ªông Server**
```java
@SpringBootApplication
public class McpServerApp {
    public static void main(String[] args) {
        SpringApplication.run(McpServerApp.class, args);
    }
}
```

---

### **4. Transport Mechanisms**
#### **4.1. C√°c Lo·∫°i Transport H·ªó Tr·ª£**
| **Lo·∫°i**          | **M√¥ T·∫£**                                                                 |
|--------------------|---------------------------------------------------------------------------|
| **Stdio**          | Giao ti·∫øp qua stdin/stdout (ph√π h·ª£p process-based)                        |
| **HTTP SSE**       | S·ª≠ d·ª•ng Server-Sent Events (Spring MVC/WebFlux)                          |
| **WebFlux SSE**    | Reactive streaming v·ªõi Project Reactor                                   |

#### **4.2. V√≠ D·ª• WebFlux SSE Transport**
```java
// Client-Side
McpClient client = McpClient.builder()
    .transport(new WebFluxSseTransport("http://localhost:8080/mcp"))
    .build();

// Server-Side
@Bean
public McpTransport serverTransport() {
    return new WebFluxSseTransport();
}
```

---

### **5. X·ª≠ L√Ω Phi√™n B·∫£n (Version 0.8.0)**
#### **5.1. Breaking Changes**
- **Session-Based Architecture**: Thay ƒë·ªïi c√°ch qu·∫£n l√Ω k·∫øt n·ªëi.
- **API Thay ƒê·ªïi**: C·∫≠p nh·∫≠t method signatures trong `McpSession`.
- **Migration Guide**: Tham kh·∫£o t√†i li·ªáu ch√≠nh th·ª©c ƒë·ªÉ c·∫≠p nh·∫≠t code.

#### **5.2. V√≠ D·ª• Migrate**
```java
// Phi√™n b·∫£n c≈© (0.7.0)
McpClient client = McpClient.create();

// Phi√™n b·∫£n m·ªõi (0.8.0)
McpClient client = McpClient.builder()
    .transport(...)
    .sessionConfigurer(...)
    .build();
```

---

### **6. Observability & Logging**
#### **6.1. B·∫≠t Logging**
```properties
# application.properties
logging.level.org.springframework.ai.mcp=DEBUG
```

#### **6.2. Theo D√µi Session**
```java
client.getSession().subscribe(session -> {
    session.onMessage().subscribe(msg -> log.info("Nh·∫≠n message: {}", msg));
    session.onClose().subscribe(() -> log.warn("Session ƒë√£ ƒë√≥ng"));
});
```

---

### **7. Best Practices**
1. **T√°ch Bi·ªát Logic**: D√πng `@Bean` ƒë·ªÉ ƒëƒÉng k√Ω tool, tr√°nh code ph·ª©c t·∫°p trong config.
2. **X·ª≠ L√Ω L·ªói**:
   ```java
   client.send(request)
       .onErrorResume(e -> {
           log.error("L·ªói g·ªçi tool", e);
           return Mono.just(McpResponse.error(e.getMessage()));
       });
   ```
3. **Qu·∫£n L√Ω Phi√™n**: Gi√°m s√°t tr·∫°ng th√°i session ƒë·ªÉ tr√°nh r√≤ r·ªâ b·ªô nh·ªõ.

---

### **K·∫øt Lu·∫≠n**
- **MCP** cung c·∫•p n·ªÅn t·∫£ng linh ho·∫°t ƒë·ªÉ t√≠ch h·ª£p AI Model v·ªõi h·ªá th·ªëng b√™n ngo√†i.
- **Spring Boot Starters** gi√∫p tri·ªÉn khai nhanh client/server v·ªõi c·∫•u h√¨nh t·ªëi gi·∫£n.
- Lu√¥n c·∫≠p nh·∫≠t phi√™n b·∫£n v√† tham kh·∫£o t√†i li·ªáu ch√≠nh th·ª©c ƒë·ªÉ tr√°nh breaking changes.

√Åp d·ª•ng MCP gi√∫p x√¢y d·ª±ng h·ªá th·ªëng AI c√≥ kh·∫£ nƒÉng m·ªü r·ªông v√† d·ªÖ b·∫£o tr√¨! üöÄ