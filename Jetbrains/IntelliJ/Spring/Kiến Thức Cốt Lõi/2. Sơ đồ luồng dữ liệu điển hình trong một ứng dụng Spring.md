<br>

D∆∞·ªõi ƒë√¢y l√† s∆° ƒë·ªì lu·ªìng d·ªØ li·ªáu ƒëi·ªÉn h√¨nh trong m·ªôt ·ª©ng d·ª•ng Spring, k√®m gi·∫£i th√≠ch chi ti·∫øt t·ª´ng b∆∞·ªõc:

---

### **S∆° ƒë·ªì t·ªïng quan**  
```
[Client] 
    ‚Üí (G·ª≠i HTTP Request) 
‚Üí [Controller] 
    ‚Üí (G·ªçi ph∆∞∆°ng th·ª©c service) 
‚Üí [Service] 
    ‚Üí (Truy v·∫•n/c·∫≠p nh·∫≠t d·ªØ li·ªáu) 
‚Üí [Repository] 
    ‚Üí (T∆∞∆°ng t√°c v·ªõi Database) 
‚Üí [Database]
```

---

### **Chi ti·∫øt t·ª´ng b∆∞·ªõc**  

#### **1. Client g·ª≠i request**  
- **Client**: Tr√¨nh duy·ªát, mobile app, Postman, ho·∫∑c ·ª©ng d·ª•ng kh√°c.  
- **HTTP Request**: GET/POST/PUT/DELETE v·ªõi endpoint (v√≠ d·ª•: `/api/users`).  
- **V√≠ d·ª•**:  
  ```http
  GET /api/users/1 HTTP/1.1
  Host: localhost:8080
  ```

---

#### **2. Controller nh·∫≠n request**  
- **Vai tr√≤**:  
  - Nh·∫≠n request, parse tham s·ªë (URL params, request body).  
  - Validate d·ªØ li·ªáu ƒë·∫ßu v√†o (d√πng `@Valid`).  
  - G·ªçi service ƒë·ªÉ x·ª≠ l√Ω logic.  
- **V√≠ d·ª•**:  
  ```java
  @RestController
  public class UserController {
      @Autowired
      private UserService userService;

      @GetMapping("/users/{id}")
      public ResponseEntity<User> getUser(@PathVariable Long id) {
          User user = userService.getUserById(id);
          return ResponseEntity.ok(user);
      }
  }
  ```

---

#### **3. Service x·ª≠ l√Ω business logic**  
- **Vai tr√≤**:  
  - Th·ª±c hi·ªán nghi·ªáp v·ª• (v√≠ d·ª•: t√≠nh to√°n, ki·ªÉm tra quy·ªÅn, g·ª≠i email).  
  - G·ªçi repository ƒë·ªÉ truy v·∫•n d·ªØ li·ªáu.  
  - Qu·∫£n l√Ω transaction (`@Transactional`).  
- **V√≠ d·ª•**:  
  ```java
  @Service
  public class UserService {
      @Autowired
      private UserRepository userRepository;

      @Transactional
      public User getUserById(Long id) {
          return userRepository.findById(id)
              .orElseThrow(() -> new UserNotFoundException("User kh√¥ng t·ªìn t·∫°i!"));
      }
  }
  ```

---

#### **4. Repository truy v·∫•n database**  
- **Vai tr√≤**:  
  - Th·ª±c hi·ªán c√°c thao t√°c CRUD (Create, Read, Update, Delete).  
  - S·ª≠ d·ª•ng Spring Data JPA ho·∫∑c JDBC.  
- **V√≠ d·ª•**:  
  ```java
  @Repository
  public interface UserRepository extends JpaRepository<User, Long> {
      // T·ª± ƒë·ªông tri·ªÉn khai ph∆∞∆°ng th·ª©c findById()
  }
  ```

---

#### **5. Database tr·∫£ k·∫øt qu·∫£**  
- **V√≠ d·ª•**:  
  - Tr·∫£ v·ªÅ b·∫£n ghi user c√≥ `id = 1` t·ª´ b·∫£ng `users`.  
  - D·ªØ li·ªáu ƒë∆∞·ª£c √°nh x·∫° th√†nh ƒë·ªëi t∆∞·ª£ng Java (Entity).  

---

#### **6. Lu·ªìng ph·∫£n h·ªìi**  
```
[Database] ‚Üí [Repository] ‚Üí [Service] ‚Üí [Controller] ‚Üí [Client]
```
- **Chi ti·∫øt**:  
  1. Repository tr·∫£ d·ªØ li·ªáu cho Service.  
  2. Service x·ª≠ l√Ω th√™m logic (n·∫øu c·∫ßn) v√† tr·∫£ k·∫øt qu·∫£ cho Controller.  
  3. Controller ƒë√≥ng g√≥i d·ªØ li·ªáu th√†nh JSON/XML v√† g·ª≠i HTTP response.  
  4. Client nh·∫≠n response.  

---

### **S∆° ƒë·ªì m·ªü r·ªông (bao g·ªìm c√°c th√†nh ph·∫ßn kh√°c)**  
```
[Client]  
    ‚Üí [Filter/Interceptor] (X·ª≠ l√Ω tr∆∞·ªõc request: auth, logging)  
    ‚Üí [Controller]  
        ‚Üí [AOP Aspect] (X·ª≠ l√Ω logic chung: logging, security)  
        ‚Üí [Service]  
            ‚Üí [External API] (G·ªçi d·ªãch v·ª• b√™n ngo√†i)  
            ‚Üí [Repository]  
                ‚Üí [Database]  
    ‚Üê [Exception Handler] (@ControllerAdvice x·ª≠ l√Ω l·ªói to√†n c·ª•c)  
    ‚Üê [Response]  
```

---

### **V√≠ d·ª• c·ª• th·ªÉ v·ªõi lu·ªìng l·ªói**  
1. **Client** g·ª≠i request GET `/users/999` (user 999 kh√¥ng t·ªìn t·∫°i).  
2. **Repository** tr·∫£ v·ªÅ `Optional.empty()`.  
3. **Service** n√©m ra `UserNotFoundException`.  
4. **ControllerAdvice** b·∫Øt exception v√† tr·∫£ v·ªÅ response l·ªói:  
   ```json
   {
     "status": 404,
     "message": "User kh√¥ng t·ªìn t·∫°i!"
   }
   ```

---

### **C√°c kh√°i ni·ªám li√™n quan**  
1. **DTO (Data Transfer Object)**:  
   - D√πng ƒë·ªÉ truy·ªÅn d·ªØ li·ªáu gi·ªØa c√°c l·ªõp (v√≠ d·ª•: `UserRequestDTO`, `UserResponseDTO`).  
   - Gi·∫£m ph·ª• thu·ªôc v√†o entity, tƒÉng t√≠nh b·∫£o m·∫≠t.  

2. **Entity**:  
   - L·ªõp √°nh x·∫° tr·ª±c ti·∫øp ƒë·∫øn b·∫£ng trong database (v√≠ d·ª•: `User`).  

3. **Mapper**:  
   - Chuy·ªÉn ƒë·ªïi gi·ªØa Entity v√† DTO (d√πng th∆∞ vi·ªán nh∆∞ MapStruct).  

---

### **Best Practices**  
- **T√°ch bi·ªát c√°c t·∫ßng**:  
  - Controller ch·ªâ x·ª≠ l√Ω HTTP, kh√¥ng ch·ª©a business logic.  
  - Service kh√¥ng ch·ª©a code truy v·∫•n database.  
- **Validation**:  
  - Validate d·ªØ li·ªáu ·ªü c·∫£ Controller (d√πng `@Valid`) v√† Service.  
- **X·ª≠ l√Ω l·ªói t·∫≠p trung**:  
  - D√πng `@ControllerAdvice` ƒë·ªÉ tr√°nh l·∫∑p code x·ª≠ l√Ω exception.  

---
Hy v·ªçng s∆° ƒë·ªì n√†y gi√∫p b·∫°n h√¨nh dung r√µ lu·ªìng d·ªØ li·ªáu trong Spring! üòä