# Ph·∫ßn 4: C√°c Ki·ªÉu D·ªØ Li·ªáu N√¢ng Cao

## 1. M·∫£ng (Arrays)

X√°c th·ª±c m·∫£ng v·ªõi ƒëi·ªÅu ki·ªán c·ª• th·ªÉ cho t·ª´ng ph·∫ßn t·ª≠:

```tsx
const tagsSchema = z.array(z.string().min(2)).max(5); // M·∫£ng 2-5 chu·ªói, m·ªói chu·ªói >= 2 k√Ω t·ª±
tagsSchema.parse(["web", "dev"]); // ‚úÖ
```

## 2. Tuple

ƒê·ªãnh nghƒ©a ch√≠nh x√°c ki·ªÉu v√† s·ªë l∆∞·ª£ng ph·∫ßn t·ª≠:

```tsx
const pointSchema = z.tuple([z.number(), z.number(), z.string().optional()]);
pointSchema.parse([10, 20]); // ‚úÖ [10, 20, undefined]
```

## 3. Union (Ho·∫∑c)

Cho ph√©p nhi·ªÅu ki·ªÉu d·ªØ li·ªáu kh√°c nhau:

```tsx
const idSchema = z.union([z.string(), z.number()]);
idSchema.parse("abc"); // ‚úÖ
idSchema.parse(123); // ‚úÖ
```

## 4. Literal (Gi√° Tr·ªã C·ªë ƒê·ªãnh)

Y√™u c·∫ßu gi√° tr·ªã ch√≠nh x√°c:

```tsx
const themeSchema = z.union([
  z.literal("dark"),
  z.literal("light"),
  z.literal("system"),
]);
themeSchema.parse("dark"); // ‚úÖ
```

## 5. Record (ƒê·ªëi T∆∞·ª£ng ƒê·ªông)

X√°c th·ª±c object v·ªõi key ƒë·ªông:

```tsx
const userMapSchema = z.record(z.string().email()); // { [key: string]: email }
userMapSchema.parse({ alice: "alice@example.com" }); // ‚úÖ
```

# Ph·∫ßn 5: X·ª≠ L√Ω T√πy Ch·ªânh

## 1. T√πy Ch·ªânh Validation v·ªõi `.refine()`

Th√™m logic ki·ªÉm tra ph·ª©c t·∫°p:

```tsx
const passwordSchema = z.string()
  .min(8)
  .refine((val) => /[A-Z]/.test(val), "Y√™u c·∫ßu √≠t nh·∫•t 1 ch·ªØ hoa");
```

## 2. Bi·∫øn ƒê·ªïi D·ªØ Li·ªáu v·ªõi `.transform()`

Ch·ªânh s·ª≠a d·ªØ li·ªáu sau khi validate:

```tsx
const toUpperCaseSchema = z.string().transform((val) => val.toUpperCase());
toUpperCaseSchema.parse("hello"); // "HELLO"
```

## 3. Async Validation

X·ª≠ l√Ω b·∫•t ƒë·ªìng b·ªô (v√≠ d·ª•: ki·ªÉm tra email t·ªìn t·∫°i trong DB):

```tsx
const uniqueEmailSchema = z.string().email().refine(
  async (email) => await isEmailUnique(email),
  "Email ƒë√£ t·ªìn t·∫°i"
);
```

# Ph·∫ßn 6: K·ªπ Thu·∫≠t Chuy√™n S√¢u

## 1. Discriminated Union

X·ª≠ l√Ω c√°c schema kh√°c nhau d·ª±a tr√™n m·ªôt tr∆∞·ªùng chung:

```tsx
const dogSchema = z.object({
  type: z.literal("dog"),
  bark: z.boolean(),
});

const catSchema = z.object({
  type: z.literal("cat"),
  meow: z.boolean(),
});

const petSchema = z.discriminatedUnion("type", [dogSchema, catSchema]);
```

## 2. Zod v·ªõi Form Data

√Åp d·ª•ng Zod ƒë·ªÉ validate form:

```tsx
// Trong Next.js API route
const formData = await request.formData();
const data = Object.fromEntries(formData.entries());
const parsedData = userSchema.parse(data);
```

## 3. Environment Variables Validation

Ki·ªÉm tra bi·∫øn m√¥i tr∆∞·ªùng:

```tsx
const envSchema = z.object({
  API_KEY: z.string().min(10),
  NODE_ENV: z.enum(["development", "production"]),
});

envSchema.parse(process.env); // Throw error n·∫øu thi·∫øu/m√¥i tr∆∞·ªùng kh√¥ng h·ª£p l·ªá
```

# Ph·∫ßn 7: Th·ªß Thu·∫≠t H·ªØu √çch

## 1. Coercion (√âp Ki·ªÉu T·ª± ƒê·ªông)

T·ª± ƒë·ªông chuy·ªÉn ƒë·ªïi ki·ªÉu d·ªØ li·ªáu ƒë·∫ßu v√†o:

```tsx
const numberSchema = z.coerce.number(); // "123" ‚Üí 123
const booleanSchema = z.coerce.boolean(); // "true" ‚Üí true
```

## 2. Extend Schema Linh Ho·∫°t

K·∫øt h·ª£p nhi·ªÅu schema:

```tsx
const baseSchema = z.object({ id: z.string() });
const userSchema = baseSchema.extend({ name: z.string() });
```

## 3. Branded Types

T·∫°o ki·ªÉu d·ªØ li·ªáu ƒë·ªôc nh·∫•t ƒë·ªÉ tr√°nh nh·∫ßm l·∫´n:

```tsx
const emailSchema = z.string().email().brand<"Email">();
type Email = z.infer<typeof emailSchema>; // string & { __brand: "Email" }
```

# Ph·∫ßn 8: T√≠ch H·ª£p v·ªõi Th∆∞ Vi·ªán Kh√°c

## 1. React Hook Form

K·∫øt h·ª£p Zod v·ªõi React Hook Form ƒë·ªÉ validate form:

```tsx
import { useForm } from "react-hook-form";
import { zodResolver } from "@hookform/resolvers/zod";

const { register, handleSubmit } = useForm({
  resolver: zodResolver(userSchema),
});
```

## 2. T·∫°o API an to√†n v·ªõi Express

Validate request body trong Express:

```tsx
app.post("/users", (req, res) => {
  const result = userSchema.safeParse(req.body);
  if (!result.success) return res.status(400).json(result.error);
  // X·ª≠ l√Ω d·ªØ li·ªáu h·ª£p l·ªá...
});
```

# Nh·ªØng g√¨ b·∫°n c√≥ th·ªÉ l√†m ti·∫øp theo?

- **Th·ª≠ nghi·ªám** v·ªõi Zod Utility Types nh∆∞ `ZodReadonly`, `ZodOptional`
    
- **Kh√°m ph√°** Zod Plugin cho VSCode ƒë·ªÉ autocomplete schema
    
- **ƒê·ªçc** Zod Documentation ƒë·ªÉ bi·∫øt c√°c c·∫≠p nh·∫≠t m·ªõi nh·∫•t
    

B·∫°n mu·ªën ƒëi s√¢u v√†o ph·∫ßn n√†o? M√¨nh c√≥ th·ªÉ cung c·∫•p v√≠ d·ª• chi ti·∫øt h∆°n cho b·∫•t k·ª≥ m·ª•c n√†o ·ªü tr√™n! üí°